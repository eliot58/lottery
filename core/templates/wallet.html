{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=400">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="{% static 'style.css' %}">
    <style>
        a {
            color: #D3D3D3;
        }
    </style>
    <script src="https://unpkg.com/@tonconnect/ui@latest/dist/tonconnect-ui.min.js"></script>
    <title>Wallet</title>
</head>
<body>
    <div class="container" style="height: 100%;">
        <div class="d-flex flex-column justify-content-between" style="height: 100%; padding: 40px 0px;">
            <div class="d-flex flex-column">
                <div class="d-flex justify-content-between">
                    <img src="{% static 'img/logo.png' %}" width="100" height="100" alt="">
                    <div class="d-flex flex-column align-items-end">
                        <h1 style="font-size: 30px; font-weight: 700;">SRP LOTTERY</h1>
                        <div class="d-flex">
                            <a href="{% url 'tickets' %}" style="font-size: 20px;">My tickets</a>
                            <a href="{% url 'mint' %}" style="font-size: 20px; margin-left: 20px;">Store</a>
                        </div>
                    </div>
                </div>
                <div style="margin-top: 20px; line-height: 24px; font-size: 18px;">
                    Предлагаем тебе принять участие в увлекательной игры, которая заключается в поиске секретной фразы восстановления кошелька, на котором находятся некоторое количество ТОНкоин. <br>Условия следующие: <br> Призовой фонд состовляет <span>2508 ТОН</span>коин в средствах, распределенных по кошелькам следующим образом:
                </div>
                <div class="table_container">
                    <table>
                        <tr>
                            <th style="border-right: 1px solid #D3D3D3; border-bottom: 1px solid #D3D3D3;">Номер кошелька</th>
                            <th style="border-bottom: 1px solid #D3D3D3;">Количество ТОНкоин</th>
                        </tr>
                        {% for wallet in wallets %}
                        <tr>
                            <td>{{wallet.id}}</td>
                            <td>{{wallet.prize}}</td>
                        </tr>
                        {% endfor %}
                    </table>
                </div>
            </div>
            <a href="#" class="continue" id="connect" style="text-align: center;">
                <img style="width: 80%;" src="{% static 'img/continue.svg' %}" alt="">
            </a>
        </div>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://unpkg.com/@tonconnect/ui@latest/dist/tonconnect-ui.min.js"></script>
    <script>

        const tonConnectUI = new TON_CONNECT_UI.TonConnectUI({
            manifestUrl: 'https://lemarchand.web3citizen.website/uploads/metadata/ton-connect.json',
            language: 'ru',
            restoreConnection: true
        });

        const connect = document.querySelector("#connect")

        connect.addEventListener("click", async function(){
            await tonConnectUI.openModal();
        })

        function getNFTItems(address) {
            var xhr = new XMLHttpRequest();
            var url = `https://testnet.tonapi.io/v2/accounts/${address}/nfts?collection=EQC6Ru_nF4l0WJTeIKdB7qQTb2WaEMqos8tQFnl3btfqO4aO&limit=1000&offset=0&indirect_ownership=false`;

            xhr.open('GET', url);

            xhr.responseType= 'json';

            xhr.onreadystatechange = function () {
                if (xhr.status == 200) {
                    if (xhr.response["nft_items"].length == 0) {
                        window.location.pathname = "/mint/"
                    }
                    else {
                        window.location.pathname = "/tickets/"
                        
                    }
                }
            };

            xhr.send();
        }



        const unsubscribe = tonConnectUI.onStatusChange(
            walletAndwalletInfo => {
                getNFTItems(walletAndwalletInfo.account.address)
            } 
        );

        


    </script>
</body>
</html>